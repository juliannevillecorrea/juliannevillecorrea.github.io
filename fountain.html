<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Something Fishy - Script</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

    <style>
        /* --- VISUAL SETUP --- */
        :root {
            --paper-width: 8.5in;
            --paper-height: 11in;
            --margin-top: 1in;
            --margin-bottom: 1in;
            --margin-left: 1.5in;
            --margin-right: 1in;
            --font-size: 12pt;
            --line-height: 12pt; 
        }

        body {
            background-color: #333; /* Dark background for web view */
            font-family: 'Courier Prime', 'Courier New', Courier, monospace;
            font-size: var(--font-size);
            line-height: 1;
            margin: 0;
            padding: 40px;
            display: flex;
            justify-content: center;
        }

        #script-container {
            background-color: white;
            width: var(--paper-width);
            min-height: var(--paper-height);
            padding: var(--margin-top) var(--margin-right) var(--margin-bottom) var(--margin-left);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            box-sizing: border-box;
        }

        /* --- SCRIPT ELEMENTS --- */
        .title-page { text-align: center; margin-top: 3in; margin-bottom: 4in; page-break-after: always; }
        .title-page .title { font-weight: bold; text-decoration: underline; text-transform: uppercase; margin-bottom: 1em; }
        .title-page .author { margin-bottom: 1em; }
        
        .scene-header { font-weight: bold; text-transform: uppercase; margin-top: 24pt; margin-bottom: 12pt; }
        .action { margin-bottom: 12pt; }
        .character { margin-left: 2.0in; width: 4in; text-transform: uppercase; margin-top: 12pt; }
        .parenthetical { margin-left: 1.5in; width: 3.5in; }
        .dialogue { margin-left: 1.0in; width: 3.5in; margin-bottom: 12pt; white-space: pre-wrap; }
        .transition { text-align: right; text-transform: uppercase; margin-bottom: 12pt; }

        /* --- PRINT SETTINGS --- */
        @media print {
            @page { size: letter; margin: 0; }
            body { background-color: white; padding: 0; margin: 0; width: 100%; }
            #script-container { width: 100%; box-shadow: none; margin: 0; padding: var(--margin-top) var(--margin-right) var(--margin-bottom) var(--margin-left); }
        }
    </style>
</head>
<body>

    <div id="script-container">Rendering...</div>

    <script>
        // 1. THE SCRIPT CONTENT
        const scriptText = `Title: something-fishy
Credit: written by
Author: Julian Correa
Source: treatment
Version: 1.0
Notes:	
	FINAL PRODUCTION DRAFT
Copyright: (c) Julian Correa 2026
Date: 21/01/2026
Watermark: something-fishy.fountain

INT. APARTMENT - NIGHT

SOLOMON (30s) is sitting on his couch, scrolling through his phone.
The room is dimly lit, with a single lamp casting a warm glow.
Suddenly, he remembers, he had to purchase some items for his mommy. From the bazaar.
He stands up, grabs his wallet, and heads out the door.

EXT. BAZAAR - NIGHT

The bazaar is bustling with activity.
Vendors shout out their wares, and colorful lights illuminate the stalls.
Solomon walks through the crowd, looking for the items on his list. Suddenly, he spots the vegetable vendor with potatoes.

SOLOMON 
Hello, how much for a kilo of potatoes?

VEGETABLE VENDOR
For you, my friend, only five dollars.

SOLOMON
Come on, my friend, I need the money. Give me some. But it was for some cheaper $3.

VEGETABLE VENDOR
Alright, alright. Three dollars it is.

SOLOMON
See you soon. Thank you. 	

VEGETABLE VENDOR
See you. Thank you my friend. 

INT. APARTMENT - NIGHT

Solomon returns to his apartment, carrying a bag of groceries.
He places the bag on the kitchen counter and begins to unpack it.
As he takes out the potatoes, he notices something strange.

MOMMY
Hey Solomon, did you get the potatoes? 

SOLOMON
Yes, Mommy.
Here they are.

MOMMY
Thank you, Solomon. You're such a good son.

SOLOMON
Anything for you, Mommy.

MOMMY
By the way, did you remember to get the fish?

SOLOMON
Fish? Oh no, I completely forgot.
I'll go back to the bazaar and get it right away.

MOMMY
Please hurry, Solomon.
I can't wait to have my favorite fish dish.

SOLOMON
OK mom, I'll get the fish right away. 

MOMMY
Thanks. So, Lou.

SOLOMON
Close the door, Mom. 

MOMMY
See you. 

EXT. BAZAAR - NIGHT

Solomon rushes back to the bazaar, determined to get the fish for his mommy.
He weaves through the crowd, searching for the fish vendor. Finally, he spots him.

SOLOMON
Hello, how much for a kilo of gobro?

FISH VENDOR
For you, my friend, only ten dollars.

SOLOMON
Ten dollars?
That's a bit steep. Can you give me a better price?`;

        // 2. SECURITY: HTML SANITIZER (Fixes XSS)
        // This ensures that any <, >, or & characters in the text are displayed as text,
        // rather than being interpreted as HTML tags.
        function escapeHtml(text) {
            if (!text) return text;
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // 3. MINI PARSER (No external dependencies)
        function parseFountain(text) {
            const lines = text.split(/\r?\n/);
            let html = "";
            let titlePage = "";
            let isTitlePage = true;

            lines.forEach((line, index) => {
                const rawLine = line.trim();
                const safeLine = escapeHtml(rawLine); // Sanitize content immediately

                // Handle Title Page (Key: Value)
                if (isTitlePage) {
                    if (rawLine.includes(':') && !rawLine.startsWith('INT.') && !rawLine.startsWith('EXT.')) {
                        const parts = rawLine.split(':');
                        const key = escapeHtml(parts[0].trim());
                        const val = escapeHtml(parts.slice(1).join(':').trim());
                        titlePage += `<div class="${key.toLowerCase().replace(' ','-')}">${val}</div>`;
                        return;
                    } else if (rawLine === "") {
                        return; 
                    } else {
                        isTitlePage = false;
                        if (titlePage) html += `<div class="title-page">${titlePage}</div>`;
                    }
                }

                if (rawLine === "") return;

                // Determine element type and wrap safe content
                if (rawLine.startsWith("INT") || rawLine.startsWith("EXT") || rawLine.startsWith("EST")) {
                    html += `<div class="scene-header">${safeLine}</div>`;
                } 
                else if (rawLine === rawLine.toUpperCase() && !rawLine.includes(":") && rawLine.length < 50) {
                    html += `<div class="character">${safeLine}</div>`;
                }
                else if (rawLine.endsWith("TO:") || (rawLine === rawLine.toUpperCase() && rawLine.includes(":"))) {
                    html += `<div class="transition">${safeLine}</div>`;
                }
                else if (rawLine.startsWith("(") && rawLine.endsWith(")")) {
                    html += `<div class="parenthetical">${safeLine}</div>`;
                }
                else {
                    let prevLine = lines[index - 1] ? lines[index - 1].trim() : "";
                    if (prevLine === prevLine.toUpperCase() && prevLine !== "" && !prevLine.startsWith("INT") && !prevLine.startsWith("EXT")) {
                        html += `<div class="dialogue">${safeLine}</div>`;
                    } else if (prevLine.startsWith("(") && prevLine.endsWith(")")) {
                        html += `<div class="dialogue">${safeLine}</div>`;
                    } else {
                        html += `<div class="action">${safeLine}</div>`;
                    }
                }
            });
            return html;
        }

        // 4. EXECUTE
        try {
            const output = parseFountain(scriptText);
            document.getElementById('script-container').innerHTML = output;
        } catch (e) {
            document.getElementById('script-container').innerText = "Error parsing script: " + e.message;
        }
    </script>
</body>
</html>
